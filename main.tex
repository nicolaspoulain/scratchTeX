\documentclass[a4paper,0.952pt]{article}
% -------------------------------------

% Marges de la page
\usepackage[left=4cm, right=1cm, top=1.5cm, bottom=1.5cm]{geometry}
\setlength{\parindent}{0mm}             % pas de retrait de paragraphe

\usepackage{graphics}
\usepackage{graphicx}                   % pour images *.jpg ou *.png
\usepackage{tikz, tkz-tab}
\usepackage{pst-all}
\usepackage{url}
\usepackage{amsfonts, amsmath, amssymb}
\usepackage[frenchb]{babel}             % règles françaises de typo
\usepackage{fontspec}                   % pour fontes spéciales utilisé par babel

\usepackage{color}
\definecolor{mouvement}{RGB}{74,108,212}
\definecolor{apparence}{RGB}{138,85,215}
\definecolor{sons}{RGB}{187,66,195}
\definecolor{stylo}{RGB}{14,154,108}
\definecolor{donnees}{RGB}{238,125,22}
\definecolor{evenements}{RGB}{200,131,48}
\definecolor{controle}{RGB}{225,169,26}
\definecolor{capteurs}{RGB}{44,165,226}
\definecolor{operateurs}{RGB}{92,183,18}
\definecolor{ajouterblocs}{RGB}{99,45,153}
\definecolor{drapeaucolor}{RGB}{63,141,21}

\def\vertloop{
  \pspolygon[fillcolor=controle,fillstyle=solid,linestyle=none](0,0)(.6,0)(.6,1)(0,1)
}


\newlength{\myl}
\newcounter{ctr}
\setcounter{ctr}{0}
\newcounter{decal}
\setcounter{decal}{0}
\newcounter{ligne}
\setcounter{ligne}{0}

\newenvironment{boucle}[1]{%----------------------------------------------------
  \settowidth{\myl}{\bfseries #1} \getlength{\myNumBE}{\the\myl}
  \addtocounter{ligne}{-1}
  \setcounter{ctr}{\thedecal}
  \loop
    \ifnum\thectr<\thedecal
    \rput(!\thectr\space 0.65 mul \theligne){\vertloop}
    \fi
    \addtocounter{ctr}{-1}
  \ifnum\thectr>-1 \repeat
  \rput(!\thedecal\space 0.65 mul \theligne){
    \psset{linearc=.05,fillcolor=controle,fillstyle=solid,linestyle=none}
    \pspolygon(0,0)(.5,0)(.5,0.95)(0,0.95)
    \pspolygon(.4,0)(2.1,0)(2.1,0.95)(1,0.95)(.9,.8)(.6,.8)(.5,0.95)(.4,0.95)
    \rput(-0.35, 0){\pspolygon(1.4,0)(1.52,0)(1.62,-.15)(1.88,-.15)(1.98,0)(2.1,0)(2.1,0.95)(1.4,0.95)}
    \pspolygon(2,0)(!\myNumBE\space .3 add 0)(!\myNumBE\space .3 add 0.95)(2,0.95)
    % \pspolygon(2,0)(5,0)(5,0.95)(2,0.95)
    \uput[0](0,0.5){\color{white}\textsf{\bfseries #1 }}
  }
  \addtocounter{decal}{1}
}{%-----------------------------------------------------------------------------
  \addtocounter{ligne}{-1}%
\setcounter{ctr}{\thedecal}%
\loop%
\rput(!\thectr\space -1 add 0.65 mul \theligne){\vertloop}%
\addtocounter{ctr}{-1}%
\ifnum\thectr>0 \repeat%
\addtocounter{decal}{-1}%
\rput(!\thedecal\space 0.65 mul \theligne){%
    \psset{linearc=.05,fillcolor=controle,fillstyle=solid,linestyle=none}
    \pspolygon(0,0)(.5,0)(.5,0.95)(0,0.95)
    \pspolygon(0.4,0)(0.52,0)(0.62,-.15)(0.88,-.15)(0.98,0)(1.1,0)(1.1,0.95)(0.4,0.95)
    \rput(-0.35,0){\pspolygon(1.2,0)(2.1,0)(2.1,0.95)(2,0.95)(1.9,.8)(1.6,.8)(1.5,0.95)(1.2,0.95)
    \pspolygon(1.2,0)(!\myNumBE\space .3 add 0)(!\myNumBE\space .3 add 0.95)(2,0.95)(1.9,.8)(1.6,.8)(1.5,0.95)(1.2,0.95)}
\rput{-90}(!\myNumBE\space -0.43 add 0.4){\color{white}\scalebox{1.7}{\textsf{$\mathbf{\Lsh}$}}}
}%
}%------------------------------------------------------------------------------






\newcommand{\bloc}[2]{% Bloc unique
  \settowidth{\myl}{\bfseries #2} \getlength{\myNum}{\the\myl}
  \addtocounter{ligne}{-1}%
\setcounter{ctr}{\thedecal}%
\loop%
    \ifnum\thedecal>0
\rput(!\thectr\space -1 add 0.65 mul \theligne){\vertloop}%
\fi
\addtocounter{ctr}{-1}%
\ifnum\thectr>0 \repeat%
\rput(!\thedecal\space 0.65 mul \theligne){
  % \psset{linearc=.05,fillcolor=#1,fillstyle=solid,linestyle=none}
\pspolygon(0,0)(.5,0)(.5,0.95)(0,0.95)
\pspolygon(.4,0)(.52,0)(.62,-.15)(.88,-.15)(.98,0)(1.1,0)(1.1,0.95)(1,0.95)(.9,.8)(.6,.8)(.5,0.95)(.4,0.95)
\pspolygon(1,0)(!\myNum\space .3 add 0)(!\myNum\space .3 add 0.95)(1,0.95)
\uput[0](0,0.5){\color{white}\textsf{\bfseries #2}}
}
}


\def\drapeau{%
\psset{linearc=.05,fillcolor=controle,fillstyle=solid,linestyle=none}
\pspolygon(0,0)(.5,0)(.5,0.95)(0,0.95)
\pspolygon(.4,0)(.52,0)(.62,-.15)(.88,-.15)(.98,0)(1.1,0)(1.1,0.95)(1,0.95)(.9,.8)(.6,.8)(.5,0.95)(.4,0.95)
\pspolygon(1,0)(5,0)(5,0.95)(1,0.95)
\uput[0](0,0.5){\color{white}\textsf{\bfseries quand  \qquad  est cliqué}}
\rput(1.15,-0.15){\pspolygon[linearc=0,linewidth=2pt,linecolor=drapeaucolor,linestyle=solid,fillcolor=drapeaucolor,fillstyle=solid](0.082,0.43)(0.2,0.95)(0.3,0.9)(0.4,0.88)(0.5,0.88)(0.7,0.92)(0.7,0.65)(0.5,0.6)(0.4,0.6)(0.3,0.65)(0.14,0.69)}
\rput(1,-0.3){
\pscustom[linestyle=none]{%
\psline(-1,1)(1,1)
\psellipticarc(0,1)(1,0.5){0}{180}
\fill}}
}


%##################################################
% Low level definitions
%##################################################
\newdimen\ypos
\ypos=0pt              % where to draw current block
% how to calculate with dimen
% \advance\ypos by 1pt % ypos = ypos + 1
% \ypos=3\ypos         % ypos = 3 * ypos

% \blockeventbase{width}
\def\blockeventbase#1#2#3{
  \def\d{0.10}
  \def\l{0.25}
  \def\yb{-0.1}
  \pscustom{%
  \psline(0,0)(0,#2)
  \psellipticarc(!1.19 #2 -0.19 add)(1.3,0.5){10}{170}
  \psline(2.6,#2)(#1,#2)(#1,0)
    (!#3 \d\space add \l\space add \d\space add 0)
    (!#3 \d\space add \l\space add \yb)
    (!#3 \d\space add \yb)
    (!#3 0)(0,0)
   \closepath
   \closedshadow
}
}
% \blockbase{width}{heihgt}{xb}{xh}
\def\blockbase#1#2#3#4{
  \def\d{0.10}
  \def\l{0.25}
  \def\yb{-0.1}
  \pspolygon(0,0)(!#3 0)
    (!#3 \d\space add \yb)
    (!#3 \d\space add \l\space add \yb)
    (!#3 \d\space add \l\space add \d\space add 0)(#1,0)
    (#1,#2)
    (!#4 \d\space add \l\space add \d\space add #2)
    (!#4 \d\space add \l\space add #2 \yb\space add)
    (!#4 \d\space add #2 \yb\space add)
    (#4,#2) (0,#2)
}

\makeatletter
\def\pst at closedshadow{%
  \addto at pscode{%
    gsave
    \psk at shadowsize \psk at shadowangle \tx at PtoC
    \tx at Shadow
    \pst at usecolor\psshadowcolor
    gsave fill grestore
    stroke
    grestore%
  }%
}
\newcommand*{\getlength}[1]{\strip@pt\dimexpr0.035146\dimexpr#1\relax\relax}
\makeatother

%##################################################
% higher level definitions
%##################################################


\makeatletter

\def\field{\@ifstar\@@field\@field}
\newcommand{\@field}[1]{%
  \psframebox*[framearc=.7,fillcolor=white,framesep=2pt]{%
    \color{black}\normalfont{\textsf{#1}}%
}}
\newcommand{\@@field}[1]{%
  \psframebox*[framearc=.7,fillcolor=white,framesep=2pt]{%
    \color{black}\normalfont{\textsf{#1}}$^\blacktriangledown$%
}}
\def\vertBlock#1#2{
  \psset{linearc=0,linestyle=none}
  \psset{fillcolor=controle,fillstyle=solid}
  \psset{shadow=false}
	\rput(-0.01,0){\pspolygon(0,-0.2)(#1,-0.2)(!#1 #2 0.2 add)(!0 #2 0.2 add)}
}


%----------------------------- \blockevent{text}
\def\blockevent#1{
  \settowidth{\myl}{\bfseries#1}
  \Gscale@div\Y \ypos{1pt} % Y=ypos but without unit (graphics package)
  \psset{linearc=0.05,linestyle=none}
  \psset{fillcolor=evenements,fillstyle=solid}
  \psset{shadow=true,shadowsize=1pt}
  \rput(0,\Y){
    \blockeventbase{\getlength{\the\myl}}{0.711}{.51}
    \psset{shadow=false}
    \uput[0](!0 0.711 2.1 div){\color{white}\textsf{\bfseries #1}}
  }
  \advance\ypos by -0.772pt % block height + a little bit
}
%----------------------------- \block{color}{text}
\def\blockblank#1{
  \settowidth{\myl}{\bfseries#1}
  \Gscale@div\Y \ypos{1pt} % Y=ypos but without unit (graphics package)
  \setcounter{ctr}{\thedecal}
  \loop
    \ifnum\thedecal>0
			\rput(!\thectr\space -1 add 0.65 mul \Y){\vertBlock{0.6}{0.711}}
    \fi
    \addtocounter{ctr}{-1}
    \ifnum\thectr>0
  \repeat
  \psset{linearc=0.05,linestyle=solid}
  \psset{fillstyle=none}
  \psset{shadow=false,shadowsize=1pt}
  \rput(!\thedecal\space 0.65 mul \Y){
    \blockbase{\getlength{\the\myl}}{0.711}{0.5}{.51}
    \psset{shadow=false}
    \uput[0](!0 0.711 2.1 div){\color{white}\textsf{\bfseries 1}}
  }
  \advance\ypos by -0.752pt % block height + a little bit
}
%----------------------------- \block{color}{text}
\def\block#1#2{
  \settowidth{\myl}{\bfseries#2}
  \Gscale@div\Y \ypos{1pt} % Y=ypos but without unit (graphics package)
  \setcounter{ctr}{\thedecal}
  \loop
    \ifnum\thedecal>0
			\rput(!\thectr\space -1 add 0.65 mul \Y){\vertBlock{0.6}{0.711}}
    \fi
    \addtocounter{ctr}{-1}
    \ifnum\thectr>0
  \repeat
  \psset{linearc=0.05,linestyle=none}
  \psset{fillcolor=#1,fillstyle=solid}
  \psset{shadow=true,shadowsize=1pt}
  \rput(!\thedecal\space 0.65 mul \Y){
    \blockbase{\getlength{\the\myl}}{0.711}{0.5}{.51}
    \psset{shadow=false}
    \uput[0](!0 0.711 2.1 div){\color{white}\textsf{\bfseries #2}}
  }
  \advance\ypos by -0.772pt % block height + a little bit
}
%----------------------------- \blockBegin{text}
\newcounter{nbloop}
\setcounter{nbloop}{0}
\def\blockBegin#1{
  \settowidth{\myl}{\bfseries#1}
  \Gscale@div\Y \ypos{1pt} % Y=ypos but without unit (graphics package)
  \psset{linearc=0.05,linestyle=none}
  \psset{fillcolor=controle,fillstyle=solid}
  \psset{shadow=true,shadowsize=1pt}
  \rput(0,\Y){
    \blockbase{\getlength{\the\myl}}{0.711}{1.15}{0.51}
    \psset{shadow=false}
    \uput[0](!0 0.711 2.1 div){\color{white}\textsf{\bfseries #1}}
  }
  \advance\ypos by -0.772pt % block height + a little bit
  \addtocounter{decal}{1}
}
\def\blockEnd{
  \settowidth{\myl}{bfseriesqqsqsqsqs}
  \Gscale@div\Y \ypos{1pt} % Y=ypos but without unit (graphics package)
  \psset{linearc=0.05,linestyle=none}
  \psset{fillcolor=controle,fillstyle=solid}
  \psset{shadow=true,shadowsize=1pt}
  \rput(0,\Y){
    \blockbase{\getlength{\the\myl}}{0.711}{0.5}{1.16}
    \psset{shadow=false}
    \uput[0](!0 0.711 2.1 div){\color{white}\textsf{\bfseries up}}
  }
  \advance\ypos by -0.772pt % block height + a little bit
  \addtocounter{decal}{-1}
}
\makeatother




\begin{document}

\section{Introduction}

\begin{pspicture}(0,1)(4,-4)%
  % \blockevent{quand ce lutin est cliqué}
	\blockevent{quand ce lutin est cliqué}
	\blockBegin{blockBegin yes}
	\block{mouvement}{donner la valeur \field{0} à x }
	\blockblank{ioioioiioio texte super long}
	\block{evenements}{le texte du bloc \field*{90}}
	\blockEnd
	\blockblank{ioioioiioio texte super long}
		% \block{stylo}{mon texte super long}
	\block{evenements}{ioioioing}
  % \blockblank{ioioioiioio texte super long}
  % \blockblank{ioioioiioio texte super long}
  % \block{evenements}{le texte du bloc \field*{90}}
\end{pspicture}

\begin{pspicture}(0,5)(4,-4)%
	\blockblank{ioioioiioio texte super long}
	\blockblank{ioioioiioio texte super long}
	\blockblank{ioiioio texte super long}
	\blockblank{ioioioiioio texte super long}
		% \block{stylo}{mon texte super long}
	\blockblank{ioioioing}
  % \blockblank{ioioioiioio texte super long}
  % \blockblank{ioioioiioio texte super long}
  % \block{evenements}{le texte du bloc \field*{90}}
\end{pspicture}

\end{document}
