%---------------------------------
\documentclass{article}
\usepackage{pst-all}
\usepackage[frenchb]{babel}
\usepackage{fontspec}

  % \blockbase w h z x y
\def\blockbase#1#2#3#4#5{
  %  (x,y)________________________(x+w,y)
  %      |            ____________|
  %(x,y-h)   (x+z,y-h)            (x+w,y-h)
  \psline(!#4 #5 #2 sub) % (x,y-h)
  (!#4 #5)               % (x,y)
  (!#4 #1 add #5)        % (x+w,y)
  (!#4 #1 add #5 #2 sub) % (x+w,y-h)
  (!#4 #3 add #5 #2 sub) % (x+z,y-h)
}
  % \blockend w h z x y
\def\blockend#1#2#3#4#5{
  %  (x,y)     (x+z,y)____________(x+w,y)
  %      |________________________|
  %(x,y-h)                        (x+w,y-h)
  \psline
  (!#4 #3 add #5)        % (x+z,y)
  (!#4 #1 add #5)        % (x+w,y)
  (!#4 #1 add #5 #2 sub) % (x+w,y-h)
  (!#4 #5 #2 sub)        % (x,y-h)
  (!#4 #5)               % (x,y)
}
\newdimen\mypos
\newdimen\mylen
\newdimen\yshift  \yshift=0pt  % pt will be removed : value is yunit
\newcount\mycount \mycount=1

\makeatletter
\newcommand*{\getlength}[1]{\strip@pt\dimexpr0.035146\dimexpr#1\relax\relax}

% \make@neName{ABC}{3}{xxx} equivaut à \def\ABCiii#1{xxx}
\gdef\make@neName#1#2#3{\expandafter\edef\csname#1\romannumeral#2\endcsname{#3}}

\def\begloop#1{
  \settowidth{\mylen}{\bfseries#1}
  % definit la largeur pour que le texte entre bien
  \expandafter\make@neName{mylen}{\number\mycount}{\the\mylen}
  % definit la position verticale du rectangle du haut
  \expandafter\make@neName{ypos}{\number\mycount}{\the\yshift}
  % mémorise le texte
  \expandafter\make@neName{text}{\number\mycount}{#1}
}
\def\endloop{
  % retrouve la largeur du texte
  \mylen=\expandafter\csname mylen\expandafter\romannumeral\mycount\endcsname
  % retrouve la position verticale du rectangle du haut
  \mypos=\expandafter\csname ypos\expandafter\romannumeral\mycount\endcsname
  % dessine  un chemin fermé à partir du rectangle du haut et de celui du bas
  \pscustom[fillcolor=lightgray,fillstyle=solid]{%
   \blockbase{\getlength{\the\mylen}}{0.711}{0.5}{0}{\strip@pt\mypos}
   \blockend{\getlength{\the\mylen}}{0.411}{0.5}{0}{\strip@pt\yshift}
  }
  % place le texte dans le rectangle du haut
  \rput[0](!0 \strip@pt\mypos\space){
    \uput[0](!0 -0.35){\expandafter\csname text\expandafter\romannumeral\mycount\endcsname}
  }
}
\makeatother

\begin{document}

\begin{pspicture}(0,0)(4,-5)%
  \begloop{Du texte ... }
  \global\advance \yshift by -3pt
  \endloop
\end{pspicture}

% \def\field#1{\psframebox*{#1}}

% \begin{pspicture}(0,0)(4,-5)%
 % \begloop{Du texte \field{encadré}... }
 % \global\advance \yshift by -3pt
 % \endloop
% \end{pspicture}

\end{document}

