\documentclass[a4paper,0.952pt]{article}
% -------------------------------------

% Marges de la page
\usepackage[left=1cm, right=1cm, top=1.5cm, bottom=1.5cm]{geometry}
\setlength{\parindent}{0mm}             % pas de retrait de paragraphe

\usepackage{trace}
\usepackage{pst-all}
\usepackage{amsfonts, amsmath, amssymb}
\usepackage[frenchb]{babel}             % règles françaises de typo
\usepackage{fontspec}                   % pour fontes spéciales utilisé par babel

\usepackage{color}
\definecolor{mouvement}{RGB}{74,108,212}
\definecolor{apparence}{RGB}{138,85,215}
\definecolor{sons}{RGB}{187,66,195}
\definecolor{stylo}{RGB}{14,154,108}
\definecolor{donnees}{RGB}{238,125,22}
\definecolor{evenements}{RGB}{200,131,48}
\definecolor{controle}{RGB}{225,169,26}
\definecolor{capteurs}{RGB}{44,165,226}
\definecolor{operateurs}{RGB}{92,183,18}
\definecolor{ajouterblocs}{RGB}{99,45,153}
\definecolor{flagcolor}{RGB}{63,141,21}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                   \blockbase{w}{h}{a}{b}{z}{x}{y}                   %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  % \blockbase w h a b z x y
\def\blockbase#1#2#3#4#5#6#7{
  %
  %  (x,y)___x+a  ________________(x+w,y)
  %      |   \___/                |
  %      |       (x+a+d+l,y+b)    |
  %      | x+z__x+b  _____________|
  %(x,y-h)      \___/             (x+w,y-h)
  %                 (b+d+l,y+b-h)
  %
  \def\b{-0.1} % height of \ (part of \_/ )
  \def\d{0.1}  % width  of \ (part of \_/ )
  \def\l{0.25} % width  of _ (part of \_/ )
  \psline(!#6 #7 #2 sub) % (x,y-h)
  (!#6 #7)               % (x,y)
  (!#6 #3 add #7)                                        % (x+a,y)
  (!#6 #3 add \d\space add \b\space #7 add)              % (x+a+d,y+b)
  (!#6 #3 add \d\space add \l\space add \b\space #7 add) % (x+a+d+l,y+b)
  (!#6 #3 add \d\space dup add add \l\space add #7)      % (x+a+2d+l,y)
  (!#6 #1 add #7)        % (x+w,y)
  (!#6 #1 add #7 #2 sub) % (x+w,y-h)
  (!#6 #4 add \d\space dup add add \l\space add #7 #2 sub)     % (x+b+2d+l,y-h)
  (!#6 #4 add \d\space add \l\space add \b\space #2 sub #7 add)% (x+b+d+l,y+b-h)
  (!#6 #4 add \d\space add \b\space #2 sub #7 add)             % (x+b+d,y+b-h)
  (!#6 #4 add #7 #2 sub)                                       % (x+b,y-h)
  (!#6 #5 add #7 #2 sub) % (x+z,y-h)
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                     \blockend{w}{h}{b}{z}{x}{y}                     %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  % \blockend w h b z x y
\def\blockend#1#2#3#4#5#6{
  %
  %  (x,y)  x+z___________________(x+w,y)
  %      |                        |
  %      |_____x+b  ______________|
  %(x,y-h)     \___/              (x+w,y-h)
  %               (x+b+d+l,y+b-h)
  %
  \def\b{-0.1} % height of \ (part of \_/ )
  \def\d{0.1}  % width  of \ (part of \_/ )
  \def\l{0.25} % width  of _ (part of \_/ )
  \psline(!#5 #4 add 0 #6 add)     % (z,0)
  (!#5 #1 add 0 #6 add)          % (w,0)
  (!#5 #1 add #2 neg #6 add)     % (w,-h)
  (!#5 #3 add \d\space dup add add \l\space add #2 neg #6 add)  % (b+2d+l,-h)
  (!#5 #3 add \d\space add \l\space add \b\space #2 sub #6 add) % (b+d+l,b-h)
  (!#5 #3 add \d\space add \b\space #2 sub #6 add)              % (b+d,b-h)
  (!#5 #3 add #2 neg #6 add)                                    % (b,-h)
  (!#5 0 add #2 neg #6 add) % (0,-h)
  (!#5 0 add 0 #6 add)           % (0,0)
}

\newdimen\mylen
\newdimen\xshift
\xshift=0pt       % pt will be removed : value is xunit
\newdimen\yshift
\yshift=0pt  % pt will be removed : value is yunit

\makeatletter
\newcommand*{\getlength}[1]{\strip@pt\dimexpr0.035146\dimexpr#1\relax\relax}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                            \field{text}                             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\def\field{\@ifstar\@@field\@field}
\newcommand{\@field}[1]{%
  \psframebox*[framearc=.7,fillcolor=white,framesep=2pt]{%
    \color{black}\normalfont{\textsf{#1}}%
}}
\newcommand{\@@field}[1]{%
  \psframebox*[framearc=.7,fillcolor=white,framesep=2pt]{%
    \color{black}\normalfont{\textsf{#1}}$^\blacktriangledown$%
}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                         \block{color}{text}                         %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\def\block{\@ifstar\@@block\@block}
\def\@block#1#2{
  \settowidth{\mylen}{\bfseries#2}
  \psset{linearc=0.05,linestyle=none}
  \psset{fillcolor=#1,fillstyle=solid}
  \psset{shadow=true,shadowsize=1pt}
  \rput(!\strip@pt\xshift\space \strip@pt\yshift){
  % \blockbase w h a b z x y
    \blockbase{\getlength{\the\mylen}}{0.711}{0.5}{.51}{0}{0}{0}
    \psset{shadow=false}
    \uput[0](!0 -0.711 2 div){\color{white}\textsf{\bfseries #2}}
  }
  \advance\yshift by -0.772pt % block height + a little bit
}
\def\@@block#1{
  \settowidth{\mylen}{\bfseries#1}
  \psset{linearc=0.05,linestyle=solid,linewidth=1pt}
  \psset{fillstyle=none}
  % \psset{fillcolor=white,fillstyle=solid}
  \psset{shadow=true,shadowsize=1pt}
  \rput(!\strip@pt\xshift\space \strip@pt\yshift){
  % \blockbase w h a b z x y
    \blockbase{\getlength{\the\mylen}}{0.811}{0.5}{.51}{0}{0}{0}
  }
  \advance\yshift by -0.872pt % block height + a little bit
}
\def\bloop#1{
  \newcount\n
  \n=#1
  \expandafter\make@neName{ypos}{\number\n}{\the\yshift}
  \advance\xshift by 0.342pt  % block width  + a little bit
  \advance\yshift by -0.772pt % block height + a little bit
   \mylen=\expandafter\csname ypos\expandafter\romannumeral\n\endcsname
   % ** \the\mylen **
}
\def\eloop#1{
  \newcount\n
  \n=#1
  \mylen=\expandafter\csname ypos\expandafter\romannumeral\n\endcsname
  \advance\xshift by -0.342pt  % block width  + a little bit
   % --- \strip@pt\mylen ---
  \psset{linearc=0.05,linestyle=none}
  \psset{fillcolor=controle,fillstyle=solid}
  \psset{shadow=true,shadowsize=1pt}
  \pscustom{%
   \blockbase{6}{0.711}{0.5}{0.84}{0.3}{\strip@pt\xshift}{\strip@pt\mylen}
   \blockend{6}{0.411}{0.5}{0.3}{\strip@pt\xshift}{\strip@pt\yshift}
   \closepath
   \closedshadow
  }
  \advance\yshift by -0.472pt % block height + a little bit
}

\def\pst at closedshadow{%
  \addto at pscode{%
    gsave
    \psk at shadowsize \psk at shadowangle \tx at PtoC
    \tx at Shadow
    \pst at usecolor\psshadowcolor
    gsave fill grestore
    stroke
    grestore%
  }%
}
\gdef\make@neName#1#2#3{\expandafter\edef\csname#1\romannumeral#2\endcsname{#3}}
\makeatother


\begin{document}

\section{Introduction}

\begin{pspicture}(0,2)(4,-10)%
  \block{stylo}{effacer tout ! }
  \bloop{2}                                        % }
  \block{mouvement}{s'orienter à \field*{90}}
  \bloop{3}                                        % }
  \block{stylo}{effacer tout ! }
  \block{stylo}{mettre la taille du stylo à \field{1}}
  \block*{TEXTE BIDON : BLOC VIDE}
  \eloop{3}
  \block{stylo}{stylo en position d'écriture}
  \eloop{2}
  \block{stylo}{mettre la taille du stylo à \field{1}}
\end{pspicture}

\end{document}

